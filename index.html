<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lista de Pacientes</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width:700px; margin:auto; }
    input, button { margin: 5px 0; padding:8px; }
    .paciente { display:flex; justify-content:space-between; align-items:center;
                padding:8px; border-bottom:1px solid #eee; }
    .meta { color:#555; font-size:0.9em; }
    .btn-eliminar { background:transparent; border:none; cursor:pointer; font-weight:bold; opacity:0.6; }
  </style>
</head>
<body>
  <h2>Agregar Paciente</h2>
  <div>
    <input id="nombre" placeholder="Nombre">
    <input id="edad" placeholder="Edad" type="number" min="0" style="width:100px">
    <input id="diagnostico" placeholder="DiagnÃ³stico">
    <button id="guardar">Guardar</button>
  </div>

  <h2>Lista de Pacientes</h2>
  <div id="lista"></div>

  <!-- Firebase SDK -->
  <script type="module">
    // Importar Firebase desde CDN (mÃ¡s fÃ¡cil que instalar nada)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc } 
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ðŸ”¹ Tu configuraciÃ³n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDyFzxJFKPQt5Ytke6vP6o33mlOEK-iGd0",
      authDomain: "pacienteswebfinal.firebaseapp.com",
      projectId: "pacienteswebfinal",
      storageBucket: "pacienteswebfinal.firebasestorage.app",
      messagingSenderId: "421058444223",
      appId: "1:421058444223:web:b84d7e0d9944a1b78e7f0a"
    };

    // Inicializar Firebase y Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const listaEl = document.getElementById('lista');
    const nombreEl = document.getElementById('nombre');
    const edadEl = document.getElementById('edad');
    const diagEl = document.getElementById('diagnostico');
    const guardarBtn = document.getElementById('guardar');

    // Escuchar cambios en la colecciÃ³n "pacientes"
    function renderizar() {
      const q = collection(db, "pacientes");
      onSnapshot(q, snapshot => {
        listaEl.innerHTML = "";
        if (snapshot.empty) {
          listaEl.innerHTML = "<div class='meta'>No hay pacientes guardados.</div>";
          return;
        }
        snapshot.forEach(docSnap => {
          const p = docSnap.data();
          const id = docSnap.id;

          const row = document.createElement('div');
          row.className = 'paciente';

          const info = document.createElement('div');
          info.innerHTML = `<strong>${p.nombre}</strong> <span class="meta">- ${p.edad} aÃ±os - ${p.diagnostico}</span>`;

          const btn = document.createElement('button');
          btn.className = 'btn-eliminar';
          btn.title = 'Eliminar';
          btn.textContent = 'âˆ’';
          btn.onclick = async () => {
            if (confirm("Â¿Eliminar este paciente?")) {
              await deleteDoc(doc(db, "pacientes", id));
            }
          };

          row.appendChild(info);
          row.appendChild(btn);
          listaEl.appendChild(row);
        });
      });
    }

    // Agregar paciente
    async function agregarPaciente() {
      const nombre = nombreEl.value.trim();
      const edad = edadEl.value.trim();
      const diagnostico = diagEl.value.trim();
      if (!nombre) {
        alert("Ingrese un nombre.");
        return;
      }
      await addDoc(collection(db, "pacientes"), {
        nombre,
        edad,
        diagnostico
      });

      nombreEl.value = "";
      edadEl.value = "";
      diagEl.value = "";
    }

    guardarBtn.addEventListener("click", agregarPaciente);

    renderizar();
  </script>
</body>
</html>
